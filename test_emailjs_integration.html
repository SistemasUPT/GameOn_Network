<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Integraci√≥n EmailJS - GameOn Network</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="email"], input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Prueba de Integraci√≥n EmailJS</h1>
            <p>GameOn Network - Sistema de Recuperaci√≥n de Contrase√±as</p>
        </div>

        <!-- Estado de Configuraci√≥n -->
        <div id="config-status" class="test-section info">
            <h3>üìã Estado de Configuraci√≥n</h3>
            <p>Verificando configuraci√≥n de EmailJS...</p>
        </div>

        <!-- Formulario de Prueba -->
        <div class="test-section">
            <h3>üìß Prueba de Env√≠o de Email</h3>
            <form id="test-form">
                <div class="form-group">
                    <label for="test-email">Email de Prueba:</label>
                    <input type="email" id="test-email" name="test-email" required 
                           placeholder="tu-email@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="test-name">Nombre de Prueba:</label>
                    <input type="text" id="test-name" name="test-name" required 
                           placeholder="Tu Nombre">
                </div>
                <button type="submit" id="send-test-btn">üöÄ Enviar Email de Prueba</button>
                <button type="button" id="check-config-btn">üîç Verificar Configuraci√≥n</button>
            </form>
        </div>

        <!-- Log de Resultados -->
        <div class="test-section">
            <h3>üìù Log de Resultados</h3>
            <div id="log" class="log">Esperando acciones...
</div>
        </div>

        <!-- Instrucciones -->
        <div class="test-section warning">
            <h3>‚ö†Ô∏è Instrucciones Importantes</h3>
            <ol>
                <li><strong>Configura EmailJS primero:</strong> Sigue las instrucciones en <code>EMAILJS_SETUP.md</code></li>
                <li><strong>Actualiza credenciales:</strong> Modifica <code>Config/emailjs_config.js</code> con tus datos reales</li>
                <li><strong>Usa email real:</strong> Ingresa un email v√°lido para recibir la prueba</li>
                <li><strong>Revisa spam:</strong> El email puede llegar a la carpeta de spam</li>
                <li><strong>L√≠mites:</strong> Plan gratuito permite 200 emails/mes</li>
            </ol>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- Configuraci√≥n EmailJS -->
    <script src="Config/emailjs_config.js"></script>

    <script>
        const log = document.getElementById('log');
        const configStatus = document.getElementById('config-status');
        const sendBtn = document.getElementById('send-test-btn');
        const checkBtn = document.getElementById('check-config-btn');

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            log.textContent += logEntry;
            log.scrollTop = log.scrollHeight;
        }

        function updateConfigStatus(status, message, type) {
            configStatus.className = `test-section ${type}`;
            configStatus.innerHTML = `<h3>üìã Estado de Configuraci√≥n</h3><p>${message}</p>`;
        }

        function checkConfiguration() {
            addLog('Verificando configuraci√≥n de EmailJS...');
            
            try {
                // Verificar si EmailJS est√° cargado
                if (typeof emailjs === 'undefined') {
                    throw new Error('EmailJS SDK no est√° cargado');
                }
                addLog('‚úÖ EmailJS SDK cargado correctamente');

                // Verificar si la configuraci√≥n est√° cargada
                if (typeof EMAILJS_CONFIG === 'undefined') {
                    throw new Error('Configuraci√≥n de EmailJS no encontrada');
                }
                addLog('‚úÖ Archivo de configuraci√≥n cargado');

                // Verificar credenciales
                const { publicKey, serviceID, templateID } = EMAILJS_CONFIG;
                
                if (!publicKey || publicKey.includes('TU_PUBLIC_KEY')) {
                    throw new Error('Public Key no configurado');
                }
                addLog('‚úÖ Public Key configurado');

                if (!serviceID || serviceID.includes('TU_SERVICE_ID')) {
                    throw new Error('Service ID no configurado');
                }
                addLog('‚úÖ Service ID configurado');

                if (!templateID || templateID.includes('TU_TEMPLATE_ID')) {
                    throw new Error('Template ID no configurado');
                }
                addLog('‚úÖ Template ID configurado');

                // Verificar si las funciones est√°n disponibles
                if (typeof initializeEmailJS !== 'function') {
                    throw new Error('Funci√≥n initializeEmailJS no encontrada');
                }
                addLog('‚úÖ Funci√≥n de inicializaci√≥n disponible');

                if (typeof sendRecoveryEmail !== 'function') {
                    throw new Error('Funci√≥n sendRecoveryEmail no encontrada');
                }
                addLog('‚úÖ Funci√≥n de env√≠o disponible');

                // Inicializar EmailJS
                initializeEmailJS();
                addLog('‚úÖ EmailJS inicializado correctamente');

                updateConfigStatus('success', '‚úÖ Configuraci√≥n completa y v√°lida', 'success');
                sendBtn.disabled = false;
                addLog('üéâ Sistema listo para enviar emails');

            } catch (error) {
                addLog(`‚ùå Error de configuraci√≥n: ${error.message}`, 'error');
                updateConfigStatus('error', `‚ùå Error: ${error.message}`, 'error');
                sendBtn.disabled = true;
            }
        }

        async function sendTestEmail() {
            const email = document.getElementById('test-email').value;
            const name = document.getElementById('test-name').value;

            if (!email || !name) {
                addLog('‚ùå Por favor completa todos los campos', 'error');
                return;
            }

            addLog(`üìß Enviando email de prueba a: ${email}`);
            sendBtn.disabled = true;
            sendBtn.textContent = '‚è≥ Enviando...';

            try {
                // Datos de prueba para el email
                const emailData = {
                    to_email: email,
                    to_name: name,
                    recovery_link: 'http://localhost/GameOn_Network/Views/Auth/reset-password.php?token=TEST_TOKEN_123',
                    expiration_time: new Date(Date.now() + 24*60*60*1000).toLocaleString('es-ES'),
                    user_type_display: 'Usuario de Prueba'
                };

                const result = await sendRecoveryEmail(emailData);

                if (result.success) {
                    addLog('‚úÖ Email enviado exitosamente!', 'success');
                    addLog(`üìä Response ID: ${result.response.text}`);
                    updateConfigStatus('success', '‚úÖ Email enviado correctamente. Revisa tu bandeja de entrada.', 'success');
                } else {
                    throw new Error(result.error?.text || 'Error desconocido');
                }

            } catch (error) {
                addLog(`‚ùå Error al enviar email: ${error.message}`, 'error');
                updateConfigStatus('error', `‚ùå Error al enviar: ${error.message}`, 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'üöÄ Enviar Email de Prueba';
            }
        }

        // Event listeners
        document.getElementById('check-config-btn').addEventListener('click', checkConfiguration);
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            sendTestEmail();
        });

        // Verificar configuraci√≥n al cargar la p√°gina
        window.addEventListener('load', function() {
            addLog('üöÄ Iniciando verificaci√≥n de EmailJS...');
            setTimeout(checkConfiguration, 1000); // Dar tiempo a que se carguen los scripts
        });
    </script>
</body>
</html>